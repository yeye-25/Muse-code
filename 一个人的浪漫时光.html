<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¸€ä¸ªäººçš„æµªæ¼«æ—¶å…‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>

.history-item {
    position: relative;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 10px 40px 10px 10px;
    margin-bottom: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.history-item:hover {
    background: rgba(255, 255, 255, 0.08);
}

.history-delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: rgba(255, 107, 107, 0.7);
    cursor: pointer;
    font-size: 14px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.history-delete-btn:hover {
    color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
}

.clear-all-history {
    width: 100%;
    padding: 8px;
    background: rgba(255, 107, 107, 0.1);
    border: 1px solid rgba(255, 107, 107, 0.3);
    border-radius: 8px;
    color: #ff6b6b;
    cursor: pointer;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 14px;
}

.clear-all-history:hover {
    background: rgba(255, 107, 107, 0.2);
}
        :root {
            --bg: #0f0c29;
            --glass: rgba(255, 255, 255, 0.08);
            --text: #f0f0f0;
            --accent: #a2d2ff;
            --sidebar-width: 300px;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", sans-serif;
        }
        body {
            height: 100vh;
            background: linear-gradient(135deg, var(--bg) 0%, #24243e 100%);
            color: var(--text);
            display: flex;
            overflow: hidden;
        }
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(15, 12, 41, 0.95);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            position: fixed;
            left: -320px;
            top: 0;
            height: 100%;
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
        }
        .sidebar.active {
            left: 0;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .sidebar-header h2 {
            font-size: 20px;
            color: var(--accent);
        }
        .close-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            color: var(--accent);
        }
        .sidebar-section {
            margin-bottom: 30px;
        }
        .sidebar-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        /* ä»Šæ—¥è®¡åˆ’ */
        .plan-input {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .plan-input input {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }
        .plan-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
        }
        .plan-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .plan-item span {
            flex: 1;
            cursor: pointer;
        }
        .plan-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }
        .plan-item button {
            background: none;
            border: none;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 18px;
        }
        /* è¯¾ç¨‹è¡¨ */
        .import-btn {
            width: 100%;
            padding: 10px;
            background: rgba(162, 210, 255, 0.1);
            border: 1px dashed rgba(162, 210, 255, 0.5);
            border-radius: 8px;
            color: var(--accent);
            cursor: pointer;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .import-btn:hover {
            background: rgba(162, 210, 255, 0.2);
        }
        .course-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 300px;
            overflow-y: auto;
        }
        .course-row {
            display: flex;
            align-items: center;
            padding: 8px 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .course-row:last-child {
            border-bottom: none;
        }
        .course-time {
            width: 60px;
            font-size: 12px;
            opacity: 0.8;
            font-weight: bold;
        }
        .course-name {
            flex: 1;
            font-size: 14px;
        }
        /* å†å²è®°å½• */
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .history-time {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        .history-title {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 5px;
        }
        .history-content {
            font-size: 13px;
            opacity: 0.9;
        }
        /* ä¸»å†…å®¹ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: margin-left 0.3s ease;
        }
        .main-content.sidebar-open {
            margin-left: var(--sidebar-width);
        }
        .menu-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 999;
            background: var(--accent);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #000;
        }
        /* æ˜Ÿç©ºèƒŒæ™¯ */
        #stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }
        /* ä¸»å¡ç‰‡ */
        .card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 28px 32px;
            width: 90%;
            max-width: 420px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 2;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 16px;
            text-align: center;
            letter-spacing: 1px;
        }
        /* ç•ªèŒ„é’Ÿ */
        .time-setter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .time-up, .time-down {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            width: 30px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .time-up:hover, .time-down:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .time-value {
            font-size: 32px;
            font-variant-numeric: tabular-nums;
            min-width: 60px;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 5px;
        }
        .time-colon {
            font-size: 32px;
            margin: 0 5px;
        }
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .timer-controls button {
            background: var(--accent);
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 600;
            min-width: 70px;
        }
        .timer-controls button:hover {
            filter: brightness(1.15);
        }
        #completeBtn {
            background: #2a9d8f;
        }
        /* å¾…åŠ */
        .todo input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            margin-bottom: 10px;
        }
        .todo ul {
            list-style: none;
            max-height: 120px;
            overflow-y: auto;
        }
        .todo li {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }
        .todo li span {
            cursor: pointer;
        }
        .done {
            text-decoration: line-through;
            opacity: 0.5;
        }
        /* æ—¥è®° */
        textarea {
            width: 100%;
            height: 100px;
            resize: none;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            padding: 8px 12px;
            margin-top: 10px;
        }
        /* === æ–°ç‰ˆéŸ³ä¹é¢æ¿ === */
        .music-launcher {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 100;
        }
        #musicMainBtn {
            background: var(--accent);
            color: #000;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            font-size: 16px;
            transition: all 0.3s ease;
        }
        #musicMainBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }
        .music-panel {
            display: none;
            position: absolute;
            bottom: 65px;
            right: 0;
            background: rgba(15, 12, 41, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            padding: 22px;
            width: 320px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .panel-header h3 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .close-panel {
            background: transparent;
            color: var(--text);
            font-size: 20px;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-panel:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .platform-list {
            margin-bottom: 20px;
        }
        .platform-item {
            display: flex;
            align-items: center;
            padding: 14px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .platform-item:hover {
            background: var(--hover-bg);
            border-color: rgba(162, 210, 255, 0.3);
            transform: translateX(-5px);
        }
        .platform-icon {
            font-size: 28px;
            margin-right: 15px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }
        .platform-info {
            flex: 1;
        }
        .platform-info strong {
            display: block;
            font-size: 16px;
            margin-bottom: 4px;
        }
        .platform-info span {
            font-size: 13px;
            opacity: 0.8;
            display: block;
        }
        .custom-search {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .custom-search p {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 12px;
            text-align: center;
        }
        .search-box {
            display: flex;
            gap: 10px;
        }
        #customSearchInput {
            flex: 1;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.07);
            color: var(--text);
            font-size: 14px;
        }
        #customSearchInput:focus {
            outline: none;
            border-color: var(--accent);
        }
        #customSearchBtn {
            padding: 12px 20px;
            white-space: nowrap;
        }
        /* å¹³å°ç‰¹å®šé¢œè‰² */
        .qqmusic { color: #31c27c; }
        .ncm { color: #e72d2c; }
        .spotify { color: #1db954; }
        .bilibili { color: #fb7299; }
         /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 300px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal h3 {
            margin-bottom: 20px;
            color: var(--accent);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .import-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .import-option {
            background: rgba(162,210,255,0.1);
            border: 1px solid rgba(162,210,255,0.3);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
        }
        .import-option:hover {
            background: rgba(162,210,255,0.2);
            transform: translateY(-2px);
        }
        .import-option i {
            color: var(--accent);
            font-size: 20px;
        }
        .text-input-area {
            width: 100%;
            height: 300px;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-family: monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: none;
            margin-bottom: 15px;
        }
        .text-input-area:focus {
            outline: none;
            border-color: var(--accent);
        }
        .example-text {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.4;
            border-left: 3px solid var(--accent);
        }
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 30px 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        .upload-area:hover {
            border-color: var(--accent);
        }
        .upload-area i {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 32px;
        }
        .upload-area p {
            margin: 10px 0;
            opacity: 0.8;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-confirm {
            background: var(--accent);
            color: #000;
        }
        .btn-confirm:hover {
            filter: brightness(1.15);
        }
        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }
        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .recognizing {
            text-align: center;
            padding: 40px 20px;
        }
        .recognizing i {
            font-size: 24px;
            color: var(--accent);
            margin-bottom: 15px;
        }
        .recognizing p {
            margin: 10px 0;
            opacity: 0.8;
        }
        .course-preview {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin: 15px 0;
        }
        .course-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .course-item:last-child {
            border-bottom: none;
        }
        .course-info {
            flex: 1;
        }
        .course-time {
            font-weight: bold;
            color: var(--accent);
            font-size: 14px;
        }
        .course-name {
            font-size: 14px;
            margin-top: 2px;
        }
        /* åœ¨ç°æœ‰çš„textareaæ ·å¼ä¸­æ·»åŠ å¤šè¡Œæ–‡æœ¬æ”¯æŒ */
textarea {
    width: 100%;
    height: 120px; /* ç¨å¾®å¢åŠ é«˜åº¦ */
    resize: vertical; /* å…è®¸å‚ç›´è°ƒæ•´å¤§å° */
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text);
    padding: 12px; /* å¢åŠ å†…è¾¹è· */
    margin-top: 15px; /* å¢åŠ ä¸Šè¾¹è· */
    font-size: 14px;
    line-height: 1.6;
    transition: all 0.3s ease;
    font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
}

/* ç„¦ç‚¹çŠ¶æ€ */
textarea:focus {
    outline: none;
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 2px rgba(162, 210, 255, 0.1);
}

/* å ä½ç¬¦æ ·å¼ */
textarea::placeholder {
    color: rgba(240, 240, 240, 0.6);
    font-size: 13px;
    line-height: 1.5;
    font-style: italic;
}

/* æ—¥è®°åŒºæ ‡é¢˜æ ·å¼ */
.diary-label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 15px 0 8px 0;
    color: var(--accent);
    font-weight: 600;
    font-size: 15px;
}

/* æ—¥è®°ç»Ÿè®¡ä¿¡æ¯ */
.diary-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 12px;
    opacity: 0.7;
}

/* æ—¥è®°ä¿å­˜çŠ¶æ€æç¤º */
.save-status {
    text-align: center;
    margin-top: 5px;
    font-size: 12px;
    opacity: 0.8;
    height: 16px;
}
    </style>
</head>
<body>
     <!-- ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ä¸ªäººä¸­å¿ƒ</h2>
            <button id="closeSidebar" class="close-btn">Ã—</button>
        </div>
        
        <div class="sidebar-content">
            <!-- ä»Šæ—¥è®¡åˆ’ -->
            <section class="sidebar-section">
                <h3><i class="fas fa-calendar-day"></i> ä»Šæ—¥è®¡åˆ’</h3>
                <div class="plan-container">
                    <div class="plan-input">
                        <input type="text" id="planInput" placeholder="æ·»åŠ ä»Šæ—¥è®¡åˆ’...">
                        <button id="addPlanBtn"><i class="fas fa-plus"></i></button>
                    </div>
                    <ul id="planList" class="plan-list"></ul>
                </div>
            </section>
            
            <!-- è¯¾ç¨‹è¡¨ -->
            <section class="sidebar-section">
                <h3><i class="fas fa-table"></i> è¯¾ç¨‹è¡¨</h3>
                <div class="course-container">
                    <!-- ä¿®æ”¹ä¸ºä¸€è¡Œä¸¤ä¸ªæŒ‰é’® -->
                    <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                        <button id="importCourseBtn" class="import-btn" style="flex: 1;">
                            <i class="fas fa-plus"></i> ä»æ•™åŠ¡ç³»ç»Ÿå¯¼å…¥
                        </button>
                        <button id="clearCoursesBtn" class="import-btn" style="background: rgba(255,107,107,0.1); border-color: rgba(255,107,107,0.3); color: #ff6b6b; flex: 0; white-space: nowrap;">
                            <i class="fas fa-trash"></i> æ¸…ç©º
                        </button>
                    </div>
                    <div id="courseTable" class="course-table">
                        <!-- è¯¾ç¨‹è¡¨å†…å®¹ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </section>
            
            <!-- å†å²è®°å½• -->
           <!-- åœ¨å†å²è®°å½•éƒ¨åˆ†æ·»åŠ æ¸…ç©ºæ‰€æœ‰æŒ‰é’® -->
<section class="sidebar-section">
    <h3><i class="fas fa-history"></i> å†å²è®°å½•</h3>
    <div id="historyList" class="history-list">
        <!-- å†å²è®°å½•ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
    <button id="clearAllHistory" class="clear-all-history">
        <i class="fas fa-trash-alt"></i> æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•
    </button>
</section>
        </div>
    </div>
    
    <!-- ä¸»å†…å®¹ -->
    <div class="main-content">
        <!-- ä¾§è¾¹æ æŒ‰é’® -->
        <button id="menuBtn" class="menu-btn">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- æ˜Ÿç©º -->
        <div id="stars"></div>
        <!-- ä¸»å¡ç‰‡ -->
        <div class="card">
            <h1>ä»Šæ—¥å¾…åŠ</h1>
            <!-- ç•ªèŒ„é’Ÿ -->
            <div class="timer">
                <div class="time-setter">
                    <div class="time-unit">
                        <button class="time-up" data-unit="min">â–²</button>
                        <div class="time-value" id="minutes">25</div>
                        <button class="time-down" data-unit="min">â–¼</button>
                    </div>
                    <span class="time-colon">:</span>
                    <div class="time-unit">
                        <button class="time-up" data-unit="sec">â–²</button>
                        <div class="time-value" id="seconds">00</div>
                        <button class="time-down" data-unit="sec">â–¼</button>
                    </div>
                </div>
                
                <div class="timer-controls">
                    <button id="startBtn">å¼€å§‹</button>
                    <button id="resetBtn">é‡ç½®</button>
                    <button id="completeBtn">å®Œæˆ</button>
                </div>
            </div>
            <!-- å¾…åŠ -->
            <div class="todo">
                <input id="todoInput" placeholder="å†™ä¸‹ä»Šæ™šçš„å°è®¡åˆ’...">
                <ul id="todoList"></ul>
            </div>
        <!-- æ—¥è®° -->
<div class="diary-container">
    <div class="diary-label">
        <i class="fas fa-book"></i>
        <span>ä»Šæ—¥æ—¥è®°</span>
    </div>
    <textarea id="diary" placeholder="ğŸ“ å†™ä¸‹ä»Šå¤©çš„æ„ŸåŠ¨...
â€¢ ä»Šå¤©æœ€æœ‰æˆå°±æ„Ÿçš„ä¸€ä»¶äº‹
â€¢ é‡åˆ°çš„å°ç¡®å¹¸æˆ–å°çƒ¦æ¼
â€¢ æ˜å¤©çš„æœŸå¾…
â€¢ æƒ³å¯¹è‡ªå·±è¯´çš„è¯
è®©ä½ çš„æ–‡å­—æˆä¸ºæ—¶å…‰çš„å°è®°..."></textarea>
    <div class="diary-stats">
        <span id="wordCount">0 å­—</span>
        <span id="lastSaved">å·²è‡ªåŠ¨ä¿å­˜</span>
    </div>
    <div id="saveStatus" class="save-status"></div></div>
</div>
    <!-- éŸ³ä¹å¯åŠ¨é¢æ¿ -->
    <div class="music-launcher">
        <button id="musicMainBtn">ğŸµ éŸ³ä¹ä¼´ä¾£</button>
        <div class="music-panel" id="musicPanel">
            <div class="panel-header">
                <h3>ğŸ¶ é€‰æ‹©éŸ³ä¹å¹³å°</h3>
                <button class="close-panel" id="closePanelBtn">Ã—</button>
            </div>
            
            <div class="platform-list">
                <div class="platform-item" data-platform="qqmusic" 
                     data-url="https://y.qq.com/portal/search.html?remoteplace=txt.yqq.top&t=song&w=è½»éŸ³ä¹ é’¢ç´ å®‰é™ æ°›å›´">
                    <div class="platform-icon qqmusic">ğŸ¹</div>
                    <div class="platform-info">
                        <strong>QQéŸ³ä¹</strong>
                        <span>è½»éŸ³ä¹ Â· é’¢ç´ Â· å®‰é™ Â· æ°›å›´</span>
                    </div>
                </div>
                
                <div class="platform-item" data-platform="ncm"
                     data-url="https://music.163.com/#/search/m/?s=è‡ªä¹  å­¦ä¹  ä¸“æ³¨ ç™½å™ªéŸ³&type=1">
                    <div class="platform-icon ncm">â˜ï¸</div>
                    <div class="platform-info">
                        <strong>ç½‘æ˜“äº‘éŸ³ä¹</strong>
                        <span>è‡ªä¹  Â· å­¦ä¹  Â· ä¸“æ³¨ Â· ç™½å™ªéŸ³</span>
                    </div>
                </div>
                <div class="platform-item" data-platform="bilibili"
                     data-url="https://www.bilibili.com/c/music/?spm_id_from=333.1007.0.0">
                    <div class="platform-icon bilibili">ğŸ“º</div>
                    <div class="platform-info">
                        <strong>å“”å“©å“”å“©éŸ³é¢‘åŒº</strong>
                        <span>éŸ³ä¹ä¸“åŒº</span>
                    </div>
                </div>
            </div>
            
            <div class="custom-search">
                <p>æˆ–æœç´¢ä»»æ„æ­Œæ›²/æ­Œæ‰‹</p>
                <div class="search-box">
                    <input type="text" id="customSearchInput" placeholder="ä¾‹å¦‚ï¼šå‘¨æ°ä¼¦ã€å¤å…¸éŸ³ä¹...">
                    <button id="customSearchBtn">æœç´¢</button>
                </div>
                <div class="search-options" style="margin-top: 12px; text-align: center;">
                    <small style="opacity: 0.7;">å°†åœ¨
                        <select id="platformSelect" style="background: rgb(255, 255, 255); color: rgb(0, 0, 0); border: none; border-radius: 4px; padding: 2px 8px;">
                            <option value="qqmusic">QQéŸ³ä¹</option>
                            <option value="ncm">ç½‘æ˜“äº‘</option>
                        </select>
                        ä¸­æœç´¢
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ========== å…¨å±€å˜é‡åˆå§‹åŒ– ========== */
        
        // è¯¾ç¨‹æ•°æ®
        const defaultCourses = [
            { time: '08:00', name: 'ç½‘ç»œæ¶ˆè´¹è€…è¡Œä¸ºå­¦' },
            { time: '09:00', name: 'å¹¿å‘Šå­¦' },
            { time: '10:00', name: 'é‡‘èäº§å“è¥é”€' },
            { time: '11:00', name: 'æ•°å­—æ–°åª’ä½“è¥é”€' },
            { time: '14:00', name: 'æ¯›æ¦‚' },
            { time: '16:00', name: 'ä½“è‚²è¯¾å¥ç¾æ“' }
        ];
        
        // å…¨å±€å˜é‡
        window.courses = JSON.parse(localStorage.getItem('solo-courses')) || [...defaultCourses];
        window.historyRecords = JSON.parse(localStorage.getItem('solo-history')) || [];
        
        /* ========== DOMå…ƒç´ è·å– ========== */
        const menuBtn = document.getElementById('menuBtn');
        const closeSidebar = document.getElementById('closeSidebar');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');
        const stars = document.getElementById('stars');
        const planInput = document.getElementById('planInput');
        const addPlanBtn = document.getElementById('addPlanBtn');
        const planList = document.getElementById('planList');
        const importCourseBtn = document.getElementById('importCourseBtn');
        const clearCoursesBtn = document.getElementById('clearCoursesBtn');
        const courseTable = document.getElementById('courseTable');
        const historyList = document.getElementById('historyList');
         const clearAllHistoryBtn = document.getElementById('clearAllHistory');
        /* ========== åŸºç¡€åŠŸèƒ½ ========== */
        
        // ç”Ÿæˆæ˜Ÿç©º
        for (let i = 0; i < 120; i++) {
            const s = document.createElement('div');
            s.className = 'star';
            s.style.left = Math.random() * 100 + '%';
            s.style.top = Math.random() * 100 + '%';
            s.style.animationDelay = Math.random() * 4 + 's';
            stars.appendChild(s);
        }
        
        // ä¾§è¾¹æ æ§åˆ¶
        menuBtn.onclick = () => {
            sidebar.classList.add('active');
            mainContent.classList.add('sidebar-open');
        };
        
        closeSidebar.onclick = () => {
            sidebar.classList.remove('active');
            mainContent.classList.remove('sidebar-open');
        };
        
        /* ========== ä»Šæ—¥è®¡åˆ’åŠŸèƒ½ ========== */
        function savePlans() {
            localStorage.setItem('solo-plans', JSON.stringify(plans));
        }
        
        function drawPlans() {
            planList.innerHTML = '';
            plans.forEach((plan, index) => {
                const li = document.createElement('li');
                li.className = `plan-item ${plan.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <span onclick="togglePlan(${index})">${plan.text}</span>
                    <button onclick="removePlan(${index})">Ã—</button>
                `;
                planList.appendChild(li);
            });
        }
        
        window.togglePlan = function(index) {
            plans[index].completed = !plans[index].completed;
            savePlans();
            drawPlans();
        };
        
        window.removePlan = function(index) {
            plans.splice(index, 1);
            savePlans();
            drawPlans();
        };
        
        let plans = JSON.parse(localStorage.getItem('solo-plans') || '[]');
        
        addPlanBtn.onclick = () => {
            if (planInput.value.trim()) {
                plans.push({
                    text: planInput.value.trim(),
                    completed: false,
                    time: new Date().toLocaleString()
                });
                planInput.value = '';
                savePlans();
                drawPlans();
            }
        };
        
        planInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && planInput.value.trim()) {
                addPlanBtn.click();
            }
        });
        
        drawPlans();
        
        /* ========== è¯¾ç¨‹è¡¨åŠŸèƒ½ ========== */
        
        // ä¿å­˜è¯¾ç¨‹
        function saveCourses() {
            localStorage.setItem('solo-courses', JSON.stringify(window.courses));
            console.log('è¯¾ç¨‹å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
        }
        
        // ç»˜åˆ¶è¯¾ç¨‹è¡¨
        function drawCourses() {
            console.log('ç»˜åˆ¶è¯¾ç¨‹è¡¨ï¼Œè¯¾ç¨‹æ•°:', window.courses.length);
            courseTable.innerHTML = '';
            
            if (window.courses.length === 0) {
                courseTable.innerHTML = '<div style="text-align: center; padding: 20px; opacity: 0.5;">æš‚æ— è¯¾ç¨‹ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯¼å…¥</div>';
                return;
            }
            
            // æŒ‰æ˜ŸæœŸåˆ†ç»„æ˜¾ç¤º
            const dayNames = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
            const dayGroups = {};
            
            window.courses.forEach(course => {
                const day = course.day || 1;
                if (!dayGroups[day]) dayGroups[day] = [];
                dayGroups[day].push(course);
            });
            
            // æŒ‰æ˜ŸæœŸé¡ºåºæ˜¾ç¤º
            for (let day = 1; day <= 7; day++) {
                if (dayGroups[day] && dayGroups[day].length > 0) {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'course-row';
                    dayHeader.innerHTML = `<div style="width: 100%; text-align: center; color: var(--accent); font-weight: bold; padding: 8px 0; background: rgba(162,210,255,0.1); border-radius: 5px; margin: 5px 0;">æ˜ŸæœŸ${dayNames[day-1]}</div>`;
                    courseTable.appendChild(dayHeader);
                    
                    // æŒ‰æ—¶é—´æ’åº
                    dayGroups[day].sort((a, b) => {
                        const timeA = parseTime(a.time);
                        const timeB = parseTime(b.time);
                        return timeA - timeB;
                    });
                    
                    dayGroups[day].forEach(course => {
                        const row = document.createElement('div');
                        row.className = 'course-row';
                        
                        // æ˜¾ç¤ºå‘¨æ¬¡ä¿¡æ¯
                        let weekInfo = '';
                        if (course.weeks && course.weeks.length > 0) {
                            if (course.weeks.length > 5) {
                                weekInfo = ` (${course.weeks.length}å‘¨)`;
                            } else {
                                weekInfo = ` (${course.weeks.join(',')}å‘¨)`;
                            }
                        }
                        
                        row.innerHTML = `
                            <div class="course-time">${course.time}</div>
                            <div class="course-name">
                                <strong>${course.name}</strong>
                                ${course.teacher ? `<br><span style="font-size: 11px; opacity: 0.8;">${course.teacher}</span>` : ''}
                                ${course.location ? `<br><span style="font-size: 11px; opacity: 0.7;">${course.location}</span>` : ''}
                                ${weekInfo}
                            </div>
                        `;
                        courseTable.appendChild(row);
                    });
                }
            }
        }
        
        // æ¸…ç©ºè¯¾ç¨‹è¡¨
        clearCoursesBtn.addEventListener('click', function() {
            if (window.courses.length === 0) {
                alert('è¯¾ç¨‹è¡¨å·²ç»æ˜¯ç©ºçš„ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¯¾ç¨‹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                window.courses = [];
                saveCourses();
                drawCourses();
                
                // æ·»åŠ å†å²è®°å½•
                addHistoryRecord('course_cleared', 'æ¸…ç©ºè¯¾ç¨‹è¡¨', 'å·²æ¸…ç©ºæ‰€æœ‰è¯¾ç¨‹');
                drawHistory();
                
                alert('è¯¾ç¨‹è¡¨å·²æ¸…ç©ºï¼');
            }
        });
        
        // å¯¼å…¥è¯¾ç¨‹è¡¨åŠŸèƒ½
        importCourseBtn.onclick = () => {
            showImportOptionsModal();
        };
        
        /* ========== è¯¾ç¨‹å¯¼å…¥ç›¸å…³å‡½æ•° ========== */
        
        // æ˜¾ç¤ºå¯¼å…¥é€‰é¡¹
        function showImportOptionsModal() {

            const modalHTML = `
                <div class="modal">
                    <div class="modal-content">
                        <h3><i class="fas fa-download"></i> å¯¼å…¥è¯¾ç¨‹è¡¨</h3>
                        <p style="text-align: center; margin-bottom: 20px; opacity: 0.8;">é€‰æ‹©å¯¼å…¥æ–¹å¼</p>
                        
                        <div class="import-options">
                            <button id="pasteTextBtn" class="import-option">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-paste"></i>
                                    <div>
                                        <div style="font-weight: bold;">ç²˜è´´è¯¾è¡¨æ–‡æœ¬ï¼ˆæ¨èï¼‰</div>
                                        <div style="font-size: 12px; opacity: 0.8;">ç›´æ¥å¤åˆ¶ç²˜è´´æ ¼å¼åŒ–çš„è¯¾è¡¨æ–‡æœ¬</div>
                                    </div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="modal-buttons">
                            <button id="cancelImport" class="btn-cancel">
                                <i class="fas fa-times"></i> å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                </div>
            `;
                    
            const modal = document.createElement('div');
            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
            
            // ç²˜è´´æ–‡æœ¬åŠŸèƒ½
            document.getElementById('pasteTextBtn').onclick = function() {
                showTextInputModal(modal);
            };
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancelImport').onclick = function() {
                document.body.removeChild(modal);
            };
        }
        
        // æ˜¾ç¤ºæ–‡æœ¬è¾“å…¥æ¨¡æ€æ¡†
        function showTextInputModal(prevModal) {
            if (prevModal) document.body.removeChild(prevModal);
            
            const modalHTML = `
                <div class="modal">
                    <div class="modal-content">
                        <h3><i class="fas fa-paste"></i> ç²˜è´´è¯¾è¡¨æ–‡æœ¬</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <p style="opacity: 0.8; margin-bottom: 10px;">è¯·ç²˜è´´ä½ çš„è¯¾è¡¨æ–‡æœ¬ï¼ˆæ ¼å¼ä¸ä½ æä¾›çš„ä¸€è‡´ï¼‰ï¼š</p>
                            <textarea class="text-input-area" id="timetableText" placeholder="ç¤ºä¾‹ï¼š
        æ˜ŸæœŸä¸€    ç¬¬1~2èŠ‚ ç¦»æ•£æ•°å­¦ ç‹è““ 1-18(å‘¨) æ ¼ç‰©æ¥¼B306
        æ˜ŸæœŸäºŒ    ç¬¬3~4èŠ‚ å¤§å­¦è‹±è¯­ æœæ˜çœŸ 1-18(å‘¨) æ ¼ç‰©æ¥¼B318
        æ˜ŸæœŸä¸‰    ç¬¬5~6èŠ‚ æ•°æ®ç»“æ„ å…¬å†¶å°ç‡• 1-17(å‘¨) æ ¼ç‰©æ¥¼B306"></textarea>
                        </div>
                        
                        <div class="example-text">
                            <div style="font-size: 12px; color: var(--accent); margin-bottom: 5px;">ğŸ“‹ è¯·ç¡®ä¿åŒ…å«ï¼š</div>
                            <div style="font-size: 11px; opacity: 0.7;">
                                1. æ˜ŸæœŸå‡ ï¼ˆæ˜ŸæœŸä¸€ã€æ˜ŸæœŸäºŒç­‰ï¼‰<br>
                                2. èŠ‚æ¬¡ï¼ˆç¬¬1~2èŠ‚ã€ç¬¬3~4èŠ‚ç­‰ï¼‰<br>
                                3. è¯¾ç¨‹åç§°<br>
                                4. æ•™å¸ˆå§“å<br>
                                5. å‘¨æ¬¡ï¼ˆå¦‚ 1-18å‘¨ï¼‰<br>
                                6. åœ°ç‚¹ï¼ˆå¦‚ æ ¼ç‰©æ¥¼B306ï¼‰
                            </div>
                        </div>
                        
                        <div class="modal-buttons">
                            <button id="parseTextBtn" class="btn-confirm">
                                <i class="fas fa-check"></i> è§£æå¹¶å¯¼å…¥
                            </button>
                            <button id="cancelTextInput" class="btn-cancel">
                                <i class="fas fa-arrow-left"></i> è¿”å›ä¸Šä¸€çº§
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
            
            // è§£ææ–‡æœ¬æŒ‰é’®
            document.getElementById('parseTextBtn').addEventListener('click', function() {
                const text = document.getElementById('timetableText').value.trim();
                if (!text) {
                    alert('è¯·è¾“å…¥è¯¾è¡¨æ–‡æœ¬');
                    return;
                }
                
                const parsedCourses = parseTimetableText(text);
                if (parsedCourses.length > 0) {
                    showParsedCourses(parsedCourses, modal);
                } else {
                    alert('æ— æ³•è§£æè¯¾è¡¨æ–‡æœ¬ï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®');
                }
            });
            
            // å–æ¶ˆ/è¿”å›æŒ‰é’®
            document.getElementById('cancelTextInput').addEventListener('click', function() {
                document.body.removeChild(modal);
                showImportOptionsModal();
            });
        }
        
        // è§£æè¯¾è¡¨æ–‡æœ¬
        function parseTimetableText(text) {
            const courses = [];
            const lines = text.split('\n').filter(line => line.trim());
            
            // èŠ‚æ¬¡æ—¶é—´æ˜ å°„
            const sessionTimes = {
                'ç¬¬1~2èŠ‚': '08:00',
                'ç¬¬3~4èŠ‚': '10:05',
                'ç¬¬5~6èŠ‚': '14:30',
                'ç¬¬7~8èŠ‚': '16:35',
                'ç¬¬9~11èŠ‚': '19:00'
            };
            
            // æ˜ŸæœŸæ˜ å°„
            const dayMapping = {
                'æ˜ŸæœŸä¸€': 1, 'æ˜ŸæœŸäºŒ': 2, 'æ˜ŸæœŸä¸‰': 3, 'æ˜ŸæœŸå››': 4,
                'æ˜ŸæœŸäº”': 5, 'æ˜ŸæœŸå…­': 6, 'æ˜ŸæœŸæ—¥': 7
            };
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                // æŸ¥æ‰¾æ˜ŸæœŸ
                let day = 0;
                for (const dayName in dayMapping) {
                    if (line.includes(dayName)) {
                        day = dayMapping[dayName];
                        break;
                    }
                }
                
                if (day === 0) return;
                
                // æŸ¥æ‰¾èŠ‚æ¬¡
                let time = '';
                for (const session in sessionTimes) {
                    if (line.includes(session)) {
                        time = sessionTimes[session];
                        break;
                    }
                }
                
                if (!time) return;
                
                // æå–è¯¾ç¨‹ä¿¡æ¯
                const parts = line.split(/\s+/).filter(p => p.trim());
                
                let courseName = '';
                let teacher = '';
                let weeks = [];
                let location = '';
                
                for (let i = 0; i < parts.length; i++) {
                    // è·³è¿‡æ˜ŸæœŸå’ŒèŠ‚æ¬¡
                    if (dayMapping[parts[i]] || Object.keys(sessionTimes).includes(parts[i])) {
                        continue;
                    }
                    
                    // ç¬¬ä¸€ä¸ªéæ˜ŸæœŸéèŠ‚æ¬¡çš„å¯èƒ½æ˜¯è¯¾ç¨‹å
                    if (!courseName && parts[i]) {
                        courseName = parts[i];
                        continue;
                    }
                    
                    // æ•™å¸ˆå
                    if (!teacher && /^[\u4e00-\u9fa5]{2,4}$/.test(parts[i])) {
                        teacher = parts[i];
                        continue;
                    }
                    
                    // å‘¨æ¬¡ä¿¡æ¯
                    if (parts[i].includes('å‘¨') && !weeks.length) {
                        weeks = parseWeeks(parts[i]);
                        continue;
                    }
                    
                    // åœ°ç‚¹
                    if (!location && parts[i].match(/[æ¥¼å®¤åœºå…]\d+/)) {
                        location = parts[i];
                        for (let j = i + 1; j < parts.length; j++) {
                            if (parts[j].match(/\d+/) || parts[j].match(/[A-Z]/)) {
                                location += parts[j];
                            } else {
                                break;
                            }
                        }
                        break;
                    }
                }
                
                if (courseName) {
                    courses.push({
                        name: courseName,
                        teacher: teacher,
                        location: location,
                        time: time,
                        day: day,
                        weeks: weeks.length > 0 ? weeks : [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18],
                        originalText: line
                    });
                }
            });
            
            return courses;
        }
        
        // è§£æå‘¨æ¬¡
        function parseWeeks(weekStr) {
            const weeks = [];
            weekStr = weekStr.replace(/[\(\ï¼ˆ].*?[\)\ï¼‰]/, '').replace('å‘¨', '');
            
            if (weekStr.includes('-')) {
                const [start, end] = weekStr.split('-').map(Number);
                for (let week = start; week <= end; week++) {
                    weeks.push(week);
                }
            } else if (weekStr.includes(',')) {
                weeks.push(...weekStr.split(',').map(Number));
            } else {
                const num = parseInt(weekStr);
                if (!isNaN(num)) weeks.push(num);
            }
            
            return weeks.filter(w => !isNaN(w));
        }
        
        // æ˜¾ç¤ºè§£æç»“æœ
        function showParsedCourses(parsedCourses, modal) {
            modal.innerHTML = `
                <div class="modal-content">
                    <h3><i class="fas fa-check-circle"></i> è§£æå®Œæˆ</h3>
                    
                    <p>æˆåŠŸè§£æ ${parsedCourses.length} é—¨è¯¾ç¨‹ï¼š</p>
                    
                    <div class="course-preview">
                        ${parsedCourses.map((course, index) => `
                            <div class="course-item">
                                <div style="display: flex; justify-content: space-between;">
                                    <div>
                                        <div class="course-time"><strong>æ˜ŸæœŸ${['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'][course.day-1]} ${course.time}</strong></div>
                                        <div class="course-name"><strong>${course.name}</strong></div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: var(--accent);">${course.teacher || 'æ•™å¸ˆ'}</div>
                                        <div style="font-size: 11px; opacity: 0.8;">${course.location || 'åœ°ç‚¹'}</div>
                                    </div>
                                </div>
                                <div style="font-size: 11px; margin-top: 5px; opacity: 0.9;">
                                    å‘¨æ¬¡ï¼š${course.weeks.join(',')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="modal-buttons">
                        <button id="confirmImport" class="btn-confirm">
                            <i class="fas fa-check"></i> ç¡®è®¤å¯¼å…¥
                        </button>
                        <button id="editCourses" class="btn-cancel">
                            <i class="fas fa-edit"></i> ç¼–è¾‘
                        </button>
                        <button id="cancelParsed" class="btn-cancel">
                            å–æ¶ˆ
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('confirmImport').addEventListener('click', function() {
                // ä½¿ç”¨å…¨å±€å˜é‡
                window.courses = parsedCourses;
                saveCourses();
                drawCourses();
                
                // æ·»åŠ å†å²è®°å½•
                addHistoryRecord('course_imported', 'å¯¼å…¥è¯¾ç¨‹è¡¨', `é€šè¿‡æ–‡æœ¬å¯¼å…¥ ${parsedCourses.length} é—¨è¯¾ç¨‹`);
                drawHistory();
                
                alert(`âœ… æˆåŠŸå¯¼å…¥ ${parsedCourses.length} é—¨è¯¾ç¨‹ï¼`);
                document.body.removeChild(modal);
            });
            
            document.getElementById('editCourses').addEventListener('click', function() {
                // è°ƒç”¨æ‰‹åŠ¨ç¼–è¾‘åŠŸèƒ½
                showManualEdit(parsedCourses, modal, 'text');
            });
            
            document.getElementById('cancelParsed').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
        }
        
        // æ‰‹åŠ¨ç¼–è¾‘ç•Œé¢
        function showManualEdit(courses, modal, source = 'text') {
            let currentCourses = [...courses];
            
            const modalContent = `
                <div class="modal-content">
                    <h3><i class="fas fa-edit"></i> ç¼–è¾‘è¯¾ç¨‹</h3>
                    <p style="opacity: 0.8; margin-bottom: 15px; font-size: 13px;">
                        ${source === 'ocr' ? 'ä¿®æ­£AIè¯†åˆ«ç»“æœ' : 'è°ƒæ•´è¯¾ç¨‹ä¿¡æ¯'}
                    </p>
                    
                    <div id="editList" style="max-height: 300px; overflow-y: auto;">
                        ${currentCourses.map((course, index) => `
                            <div class="course-item" style="margin-bottom: 12px; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px;">
                                    <div>
                                        <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 4px;">æ˜ŸæœŸ</label>
                                        <select id="daySelect_${index}" 
                                                style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: var(--text);">
                                            ${[1,2,3,4,5,6,7].map(d => `<option value="${d}" ${course.day === d ? 'selected' : ''}>æ˜ŸæœŸ${['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'][d-1]}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div>
                                        <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 4px;">æ—¶é—´</label>
                                        <select id="timeSelect_${index}"
                                                style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: var(--text);">
                                            <option value="08:00" ${course.time === '08:00' ? 'selected' : ''}>ç¬¬1~2èŠ‚ (08:00)</option>
                                            <option value="10:05" ${course.time === '10:05' ? 'selected' : ''}>ç¬¬3~4èŠ‚ (10:05)</option>
                                            <option value="14:30" ${course.time === '14:30' ? 'selected' : ''}>ç¬¬5~6èŠ‚ (14:30)</option>
                                            <option value="16:35" ${course.time === '16:35' ? 'selected' : ''}>ç¬¬7~8èŠ‚ (16:35)</option>
                                            <option value="19:00" ${course.time === '19:00' ? 'selected' : ''}>ç¬¬9~11èŠ‚ (19:00)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 8px;">
                                    <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 4px;">è¯¾ç¨‹åç§°</label>
                                    <input type="text" id="nameInput_${index}" value="${course.name}" 
                                           style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: var(--text);">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px;">
                                    <div>
                                        <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 4px;">æ•™å¸ˆ</label>
                                        <input type="text" id="teacherInput_${index}" value="${course.teacher || ''}" 
                                               style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: var(--text);">
                                    </div>
                                    <div>
                                        <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 4px;">åœ°ç‚¹</label>
                                        <input type="text" id="locationInput_${index}" value="${course.location || ''}" 
                                               style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: var(--text);">
                                    </div>
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; opacity: 0.8; display: block; margin-bottom: 4px;">ä¸Šè¯¾å‘¨æ¬¡ (å¦‚: 1-18 æˆ– 1,3,5,7)</label>
                                    <input type="text" id="weeksInput_${index}" value="${course.weeks?.join(',') || '1-18'}" 
                                           style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: var(--text);">
                                </div>
                                
                                <div style="text-align: right; margin-top: 8px;">
                                    <button onclick="removeEditCourse(${index})" 
                                            style="background: rgba(255,107,107,0.1); color: #ff6b6b; border: 1px solid rgba(255,107,107,0.3); padding: 4px 10px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                                        <i class="fas fa-trash"></i> åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <button id="addNewCourseBtn" style="width: 100%; padding: 10px; margin: 10px 0; background: rgba(162,210,255,0.1); border: 1px solid rgba(162,210,255,0.3); color: var(--accent); border-radius: 6px; cursor: pointer;">
                        <i class="fas fa-plus"></i> æ·»åŠ æ–°è¯¾ç¨‹
                    </button>
                    
                    <div class="modal-buttons">
                        <button id="saveEditBtn" class="btn-confirm">
                            <i class="fas fa-save"></i> ä¿å­˜
                        </button>
                        <button id="backEditBtn" class="btn-cancel">
                            <i class="fas fa-arrow-left"></i> è¿”å›
                        </button>
                    </div>
                </div>
            `;
            
            modal.innerHTML = modalContent;
            
            // ä¸ºæ¯ä¸ªè¾“å…¥ç»‘å®šäº‹ä»¶
            currentCourses.forEach((_, index) => {
                // æ˜ŸæœŸé€‰æ‹©
                document.getElementById(`daySelect_${index}`).addEventListener('change', function() {
                    currentCourses[index].day = parseInt(this.value);
                });
                
                // æ—¶é—´é€‰æ‹©
                document.getElementById(`timeSelect_${index}`).addEventListener('change', function() {
                    currentCourses[index].time = this.value;
                });
                
                // è¯¾ç¨‹åç§°
                document.getElementById(`nameInput_${index}`).addEventListener('input', function() {
                    currentCourses[index].name = this.value;
                });
                
                // æ•™å¸ˆ
                document.getElementById(`teacherInput_${index}`).addEventListener('input', function() {
                    currentCourses[index].teacher = this.value;
                });
                
                // åœ°ç‚¹
                document.getElementById(`locationInput_${index}`).addEventListener('input', function() {
                    currentCourses[index].location = this.value;
                });
                
                // å‘¨æ¬¡
                document.getElementById(`weeksInput_${index}`).addEventListener('input', function() {
                    currentCourses[index].weeks = parseWeeks(this.value);
                });
            });
            
            // åˆ é™¤è¯¾ç¨‹
            window.removeEditCourse = function(index) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é—¨è¯¾ç¨‹å—ï¼Ÿ')) {
                    currentCourses.splice(index, 1);
                    // é‡æ–°æ¸²æŸ“ç¼–è¾‘ç•Œé¢
                    showManualEdit(currentCourses, modal, source);
                }
            };
            
            // æ·»åŠ æ–°è¯¾ç¨‹
            document.getElementById('addNewCourseBtn').addEventListener('click', function() {
                currentCourses.push({
                    name: 'æ–°è¯¾ç¨‹',
                    teacher: '',
                    location: '',
                    time: '08:00',
                    day: 1,
                    weeks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18]
                });
                // é‡æ–°æ¸²æŸ“ç¼–è¾‘ç•Œé¢
                showManualEdit(currentCourses, modal, source);
            });
            
            // ä¿å­˜ç¼–è¾‘
            document.getElementById('saveEditBtn').addEventListener('click', function() {
                window.courses = currentCourses;
                saveCourses();
                drawCourses();
                
                // æ·»åŠ å†å²è®°å½•
                addHistoryRecord('course_imported', 'ç¼–è¾‘è¯¾ç¨‹è¡¨', `æ‰‹åŠ¨ç¼–è¾‘äº† ${currentCourses.length} é—¨è¯¾ç¨‹`);
                drawHistory();
                
                alert('âœ… è¯¾ç¨‹å·²ä¿å­˜ï¼');
                document.body.removeChild(modal);
            });
            
            // è¿”å›æŒ‰é’®
            document.getElementById('backEditBtn').addEventListener('click', function() {
                showParsedCourses(currentCourses, modal);
            });
        }
        
        // è§£ææ—¶é—´ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰
        function parseTime(timeStr) {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + (minutes || 0);
        }
        
        /* ========== å†å²è®°å½•åŠŸèƒ½ ========== */
        
        function saveHistory() {
            localStorage.setItem('solo-history', JSON.stringify(window.historyRecords));
        }
        
        function drawHistory() {
    console.log('ç»˜åˆ¶å†å²è®°å½•ï¼Œè®°å½•æ•°:', window.historyRecords.length);
    historyList.innerHTML = '';
    
    if (window.historyRecords.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.className = 'history-item';
        emptyMsg.innerHTML = '<p style="text-align: center; opacity: 0.5;">æš‚æ— å†å²è®°å½•</p>';
        historyList.appendChild(emptyMsg);
        return;
    }
    
    // å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°çš„åœ¨æœ€å‰é¢ï¼‰
    window.historyRecords.slice().reverse().forEach((record, displayIndex) => {
        const item = document.createElement('div');
        item.className = 'history-item';
        
        // è®¡ç®—å®é™…ç´¢å¼•ï¼ˆå› ä¸ºå€’åºæ˜¾ç¤ºï¼‰
        const actualIndex = window.historyRecords.length - 1 - displayIndex;
        
        let content = '';
        if (record.type === 'todo_completed') {
            content = `âœ… å®Œæˆå¾…åŠäº‹é¡¹<br>${record.todoCount || 0} ä¸ªäº‹é¡¹å·²å®Œæˆ`;
        } else if (record.type === 'pomodoro_completed') {
            content = `ğŸ… ç•ªèŒ„é’Ÿå®Œæˆ<br>æ—¶é•¿: ${record.duration || 'æœªçŸ¥'}`;
        } else if (record.type === 'plan_completed') {
            content = `ğŸ“ è®¡åˆ’å®Œæˆ<br>${record.content || ''}`;
        } else if (record.type === 'course_imported') {
            content = `ğŸ“š å¯¼å…¥è¯¾ç¨‹è¡¨<br>${record.content || ''}`;
        } else if (record.type === 'course_cleared') {
            content = `ğŸ—‘ï¸ æ¸…ç©ºè¯¾ç¨‹è¡¨<br>${record.content || ''}`;
        } else {
            content = record.content || 'å·²å®Œæˆäº‹é¡¹';
        }
        
        item.innerHTML = `
            <div class="history-time">${record.time || 'æœªçŸ¥æ—¶é—´'}</div>
            <div class="history-title">${record.title || 'å®Œæˆäº‹é¡¹'}</div>
            <div class="history-content">${content}</div>
            <button class="history-delete-btn" data-index="${actualIndex}">
                <i class="fas fa-times"></i>
            </button>
        `;
        historyList.appendChild(item);
    });
    
    // ä¸ºæ‰€æœ‰åˆ é™¤æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.history-delete-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
            const index = parseInt(this.getAttribute('data-index'));
            deleteHistoryRecord(index);
        });
    });
}
            
            // å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°çš„åœ¨æœ€å‰é¢ï¼‰
            window.historyRecords.slice().reverse().forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                let content = '';
                if (record.type === 'todo_completed') {
                    content = `âœ… å®Œæˆå¾…åŠäº‹é¡¹<br>${record.todoCount || 0} ä¸ªäº‹é¡¹å·²å®Œæˆ`;
                } else if (record.type === 'pomodoro_completed') {
                    content = `ğŸ… ç•ªèŒ„é’Ÿå®Œæˆ<br>æ—¶é•¿: ${record.duration || 'æœªçŸ¥'}`;
                } else if (record.type === 'plan_completed') {
                    content = `ğŸ“ è®¡åˆ’å®Œæˆ<br>${record.content || ''}`;
                } else if (record.type === 'course_imported') {
                    content = `ğŸ“š å¯¼å…¥è¯¾ç¨‹è¡¨<br>${record.content || ''}`;
                } else if (record.type === 'course_cleared') {
                    content = `ğŸ—‘ï¸ æ¸…ç©ºè¯¾ç¨‹è¡¨<br>${record.content || ''}`;
                } else {
                    content = record.content || 'å·²å®Œæˆäº‹é¡¹';
                }
                
                item.innerHTML = `
                    <div class="history-time">${record.time || 'æœªçŸ¥æ—¶é—´'}</div>
                    <div class="history-title">${record.title || 'å®Œæˆäº‹é¡¹'}</div>
                    <div class="history-content">${content}</div>
                `;
                historyList.appendChild(item);
            });
        
        
        // æ·»åŠ å†å²è®°å½•
        function addHistoryRecord(type, title, content, extraData = {}) {
    
            const record = {
                time: new Date().toLocaleString(),
                type: type,
                title: title,
                content: content,
                ...extraData
            };
            
            window.historyRecords.push(record);
            
            if (window.historyRecords.length > 50) {
                window.historyRecords = window.historyRecords.slice(-50);
            }
            
            saveHistory();
            console.log('å†å²è®°å½•å·²æ·»åŠ :', record.title);
        }
        // åˆ é™¤å•æ¡å†å²è®°å½•
function deleteHistoryRecord(index) {
    if (index < 0 || index >= window.historyRecords.length) return;
    
    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿ')) {
        // ä»æ•°ç»„ä¸­åˆ é™¤
        window.historyRecords.splice(index, 1);
        
        // ä¿å­˜åˆ°localStorage
        saveHistory();
        
        // é‡æ–°ç»˜åˆ¶å†å²è®°å½•
        drawHistory();
        
        console.log(`å·²åˆ é™¤å†å²è®°å½•ç´¢å¼• ${index}`);
    }
}// åœ¨é¡µé¢åŠ è½½å®Œæˆéƒ¨åˆ†æ·»åŠ 
document.addEventListener('DOMContentLoaded', function() {
    console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–æ•°æ®...');
    console.log('è¯¾ç¨‹æ•°æ®:', window.courses);
    console.log('å†å²è®°å½•:', window.historyRecords);
    
    drawCourses();
    drawHistory();
    
    // ç¡®ä¿æ¸…ç©ºæŒ‰é’®äº‹ä»¶ç»‘å®š
    clearAllHistoryBtn.addEventListener('click', function() {
        if (window.historyRecords.length === 0) {
            alert('å†å²è®°å½•å·²ç»æ˜¯ç©ºçš„ï¼');
            return;
        }
        
        if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
            window.historyRecords = [];
            saveHistory();
            drawHistory();
            alert('å†å²è®°å½•å·²æ¸…ç©ºï¼');
        }
    });
});// æ·»åŠ é•¿æŒ‰åˆ é™¤æç¤º
let longPressTimer = null;

document.addEventListener('mousedown', function(e) {
    if (e.target.classList.contains('history-delete-btn')) {
        longPressTimer = setTimeout(() => {
            const index = parseInt(e.target.getAttribute('data-index'));
            if (confirm('é•¿æŒ‰ç¡®è®¤åˆ é™¤è¿™æ¡è®°å½•ï¼Ÿ')) {
                deleteHistoryRecord(index);
            }
        }, 1000); // é•¿æŒ‰1ç§’
    }
});

document.addEventListener('mouseup', function(e) {
    if (e.target.classList.contains('history-delete-btn')) {
        clearTimeout(longPressTimer);
    }
});

// æ·»åŠ é”®ç›˜æ”¯æŒ
document.addEventListener('keydown', function(e) {
    if (e.key === 'Delete' || e.key === 'Backspace') {
        const focusedDeleteBtn = document.querySelector('.history-delete-btn:hover');
        if (focusedDeleteBtn) {
            const index = parseInt(focusedDeleteBtn.getAttribute('data-index'));
            deleteHistoryRecord(index);
        }
    }
});
        /* ========== ç•ªèŒ„é’ŸåŠŸèƒ½ ========== */
        let min = 25;
        let sec = 0;
        let tId = null;
        let originalMin = 25;
        let originalSec = 0;
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const completeBtn = document.getElementById('completeBtn');
        const minutesDisplay = document.getElementById('minutes');
        const secondsDisplay = document.getElementById('seconds');
        
        function renderTimer() {
            minutesDisplay.textContent = String(min).padStart(2, '0');
            secondsDisplay.textContent = String(sec).padStart(2, '0');
        }
        
        document.querySelectorAll('.time-up').forEach(btn => {
            btn.onclick = () => {
                const unit = btn.dataset.unit;
                if (unit === 'min') {
                    min = Math.min(99, min + 1);
                } else {
                    sec = Math.min(59, sec + 1);
                    if (sec === 60) {
                        sec = 0;
                        min = Math.min(99, min + 1);
                    }
                }
                renderTimer();
            };
        });
        
        document.querySelectorAll('.time-down').forEach(btn => {
            btn.onclick = () => {
                const unit = btn.dataset.unit;
                if (unit === 'min') {
                    min = Math.max(0, min - 1);
                } else {
                    sec = Math.max(0, sec - 1);
                    if (sec < 0) {
                        if (min > 0) {
                            min--;
                            sec = 59;
                        } else {
                            sec = 0;
                        }
                    }
                }
                renderTimer();
            };
        });
        
        startBtn.onclick = () => {
            if (tId) {
                clearInterval(tId);
                tId = null;
                startBtn.textContent = 'ç»§ç»­';
            } else {
                if (startBtn.textContent === 'å¼€å§‹' || startBtn.textContent === 'ç»§ç»­') {
                    originalMin = min;
                    originalSec = sec;
                    startBtn.textContent = 'æš‚åœ';
                    tId = setInterval(() => {
                        if (sec === 0) {
                            if (min === 0) {
                                clearInterval(tId);
                                tId = null;
                                startBtn.textContent = 'å¼€å§‹';
                                addHistoryRecord('pomodoro_completed', 'ç•ªèŒ„é’Ÿå®Œæˆ', `æ—¶é•¿: ${originalMin}:${String(originalSec).padStart(2, '0')}`, {
                                    duration: `${originalMin}:${String(originalSec).padStart(2, '0')}`
                                });
                                drawHistory();
                                alert('ç•ªèŒ„é’Ÿå®Œæˆï¼');
                                return;
                            }
                            min--;
                            sec = 59;
                        } else {
                            sec--;
                        }
                        renderTimer();
                    }, 1000);
                }
            }
        };
        
        resetBtn.onclick = () => {
            clearInterval(tId);
            tId = null;
            min = originalMin;
            sec = originalSec;
            renderTimer();
            startBtn.textContent = 'å¼€å§‹';
        };
        
        completeBtn.onclick = () => {
            if (tId) {
                clearInterval(tId);
                tId = null;
            }
            
            const completedTodos = todos.filter(todo => todo.done);
            const uncompletedTodos = todos.filter(todo => !todo.done);
            const diaryContent = diary.value.trim();
            
            let summary = '';
            
            if (completedTodos.length > 0) {
                summary += `âœ… å·²å®Œæˆ ${completedTodos.length} ä¸ªäº‹é¡¹:<br>`;
                completedTodos.forEach((todo, index) => {
                    summary += `${index + 1}. ${todo.text}<br>`;
                });
            }
            
            if (uncompletedTodos.length > 0) {
                summary += `<br>âŒ æœªå®Œæˆ ${uncompletedTodos.length} ä¸ªäº‹é¡¹:<br>`;
                uncompletedTodos.forEach((todo, index) => {
                    summary += `${index + 1}. ${todo.text}<br>`;
                });
            }
            
            if (diaryContent) {
                summary += `<br>ğŸ“ æ—¥è®°æ‘˜è¦:<br>${diaryContent.substring(0, 100)}${diaryContent.length > 100 ? '...' : ''}`;
            }
            
            const pomodoroDuration = `${originalMin}:${String(originalSec).padStart(2, '0')}`;
            
            addHistoryRecord('todo_completed', 'ä»Šæ—¥å¾…åŠå®Œæˆ', summary, {
                todoCount: todos.length,
                completedCount: completedTodos.length,
                pomodoroDuration: pomodoroDuration,
                diaryPreview: diaryContent.substring(0, 100)
            });
            drawHistory();
            
            min = originalMin;
            sec = originalSec;
            renderTimer();
            startBtn.textContent = 'å¼€å§‹';
            
            alert(`âœ… ä»Šæ—¥å¾…åŠå·²è®°å½•åˆ°å†å²ï¼\nå·²å®Œæˆ ${completedTodos.length}/${todos.length} ä¸ªäº‹é¡¹`);
        };
        
        renderTimer();
        
        /* ========== å¾…åŠåŠŸèƒ½ ========== */
        const todoInput = document.getElementById('todoInput');
        const todoList = document.getElementById('todoList');
        let todos = JSON.parse(localStorage.getItem('solo-todos') || '[]');
        
        function saveTodos() {
            localStorage.setItem('solo-todos', JSON.stringify(todos));
        }
        
        function drawTodos() {
            todoList.innerHTML = '';
            todos.forEach((t, i) => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="${t.done ? 'done' : ''}" data-i="${i}">${t.text}</span>
                                <button data-i="${i}">Ã—</button>`;
                todoList.appendChild(li);
            });
        }
        
        todoInput.addEventListener('keydown', e => {
            if (e.key === 'Enter' && todoInput.value.trim()) {
                todos.push({ text: todoInput.value.trim(), done: false });
                todoInput.value = '';
                saveTodos();
                drawTodos();
            }
        });
        
        todoList.addEventListener('click', e => {
            if (e.target.tagName === 'SPAN') {
                const i = +e.target.dataset.i;
                todos[i].done = !todos[i].done;
                saveTodos();
                drawTodos();
            }
            if (e.target.tagName === 'BUTTON') {
                const i = +e.target.dataset.i;
                todos.splice(i, 1);
                saveTodos();
                drawTodos();
            }
        });
        
        drawTodos();
        // å¯¼å‡ºæ—¥è®°åŠŸèƒ½
function exportDiary() {
    const diaryContent = diary.value;
    if (!diaryContent.trim()) {
        alert('æ—¥è®°å†…å®¹ä¸ºç©ºï¼');
        return;
    }
    
    const blob = new Blob([diaryContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const date = new Date().toISOString().split('T')[0];
    
    a.href = url;
    a.download = `æ—¥è®°-${date}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('æ—¥è®°å·²å¯¼å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶ï¼');
}

// å¯¼å…¥æ—¥è®°åŠŸèƒ½
function importDiary() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.txt';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
            diary.value = event.target.result;
            updateWordCount();
            updateLastSavedTime();
            alert('æ—¥è®°å¯¼å…¥æˆåŠŸï¼');
        };
        reader.readAsText(file);
    };
    
    input.click();
}

// æ·»åŠ å¯¼å‡ºå¯¼å…¥æŒ‰é’®åˆ°é¡µé¢
function addDiaryTools() {
    const toolsDiv = document.createElement('div');
    toolsDiv.className = 'diary-tools';
    toolsDiv.style.cssText = `
        display: flex;
        gap: 10px;
        margin-top: 10px;
        justify-content: center;
    `;
    
    const exportBtn = document.createElement('button');
    exportBtn.innerHTML = '<i class="fas fa-download"></i> å¯¼å‡ºæ—¥è®°';
    exportBtn.onclick = exportDiary;
    
    const importBtn = document.createElement('button');
    importBtn.innerHTML = '<i class="fas fa-upload"></i> å¯¼å…¥æ—¥è®°';
    importBtn.onclick = importDiary;
    
    // è®¾ç½®æŒ‰é’®æ ·å¼
    [exportBtn, importBtn].forEach(btn => {
        btn.style.cssText = `
            padding: 6px 12px;
            background: rgba(162, 210, 255, 0.1);
            border: 1px solid rgba(162, 210, 255, 0.3);
            color: var(--accent);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        `;
        btn.onmouseover = () => btn.style.background = 'rgba(162, 210, 255, 0.2)';
        btn.onmouseout = () => btn.style.background = 'rgba(162, 210, 255, 0.1)';
    });
    
    toolsDiv.appendChild(exportBtn);
    toolsDiv.appendChild(importBtn);
    
    // æ’å…¥åˆ°æ—¥è®°åŒºåŸŸåé¢
    const diaryContainer = document.querySelector('.diary-container') || diary.parentElement;
    diaryContainer.appendChild(toolsDiv);
}

// åœ¨é¡µé¢åŠ è½½æ—¶æ·»åŠ å·¥å…·æŒ‰é’®
document.addEventListener('DOMContentLoaded', function() {
    initDiary();
    setTimeout(addDiaryTools, 100); // ç¨åæ·»åŠ ï¼Œç¡®ä¿DOMå·²åŠ è½½
});
        
       /* ========== æ—¥è®°å¢å¼ºåŠŸèƒ½ ========== */
const wordCountElement = document.getElementById('wordCount');
const lastSavedElement = document.getElementById('lastSaved');
const saveStatusElement = document.getElementById('saveStatus');
let saveTimer = null;
let lastSaveTime = null;


// ç»Ÿè®¡å­—æ•°
function updateWordCount() {
    const text = diary.value;
    const wordCount = text.replace(/\s+/g, '').length; // å»é™¤ç©ºæ ¼ç»Ÿè®¡
    wordCountElement.textContent = `${wordCount} å­—`;
    
    // æ ¹æ®å­—æ•°æ˜¾ç¤ºé¢œè‰²
    if (wordCount === 0) {
        wordCountElement.style.color = 'rgba(240, 240, 240, 0.5)';
    } else if (wordCount < 50) {
        wordCountElement.style.color = '#ff6b6b'; // çº¢è‰²ï¼Œå­—æ•°è¾ƒå°‘
    } else if (wordCount < 200) {
        wordCountElement.style.color = '#feca57'; // é»„è‰²ï¼Œé€‚ä¸­
    } else {
        wordCountElement.style.color = '#1dd1a1'; // ç»¿è‰²ï¼Œå­—æ•°å……è¶³
    }
}

// æ˜¾ç¤ºä¿å­˜çŠ¶æ€
function showSaveStatus(message, type = 'info') {
    saveStatusElement.textContent = message;
    saveStatusElement.style.color = type === 'saving' ? '#feca57' : 
                                   type === 'saved' ? '#1dd1a1' : 
                                   type === 'error' ? '#ff6b6b' : 
                                   'rgba(240, 240, 240, 0.8)';
    
    // 3ç§’åæ¸…é™¤çŠ¶æ€
    clearTimeout(saveTimer);
    saveTimer = setTimeout(() => {
        saveStatusElement.textContent = '';
    }, 3000);
}

// æ›´æ–°æœ€åä¿å­˜æ—¶é—´
function updateLastSavedTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('zh-CN', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });
    lastSavedElement.textContent = `${timeStr} ä¿å­˜`;
    lastSaveTime = now;
    
    // ä¿å­˜åˆ°localStorage
    localStorage.setItem('solo-diary', diary.value);
    localStorage.setItem('solo-diary-last-saved', now.toISOString());
}

// åˆå§‹åŒ–æ—¥è®°åŠŸèƒ½
function initDiary() {
    // åŠ è½½ä¸Šæ¬¡ä¿å­˜çš„å†…å®¹
    const savedDiary = localStorage.getItem('solo-diary');
    const lastSaved = localStorage.getItem('solo-diary-last-saved');
    
    if (savedDiary) {
        diary.value = savedDiary;
    }
    
    if (lastSaved) {
        const lastTime = new Date(lastSaved);
        const timeStr = lastTime.toLocaleTimeString('zh-CN', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        lastSavedElement.textContent = `${timeStr} ä¿å­˜`;
        lastSaveTime = lastTime;
    }
    
    // åˆå§‹å­—æ•°ç»Ÿè®¡
    updateWordCount();
    
    // ç›‘å¬è¾“å…¥äº‹ä»¶
    diary.addEventListener('input', () => {
        updateWordCount();
        
        // æ˜¾ç¤ºæ­£åœ¨ä¿å­˜çŠ¶æ€
        showSaveStatus('æ­£åœ¨ä¿å­˜...', 'saving');
        
        // é˜²æŠ–ä¿å­˜ï¼ˆ500æ¯«ç§’åä¿å­˜ï¼‰
        clearTimeout(saveTimer);
        saveTimer = setTimeout(() => {
            updateLastSavedTime();
            showSaveStatus('âœ“ å·²ä¿å­˜', 'saved');
        }, 500);
    });
    
    // ç›‘å¬ç„¦ç‚¹äº‹ä»¶
    diary.addEventListener('focus', () => {
        diary.style.background = 'rgba(255, 255, 255, 0.08)';
    });
    
    diary.addEventListener('blur', () => {
        diary.style.background = 'rgba(255, 255, 255, 0.05)';
    });
    
    // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
    diary.addEventListener('keydown', (e) => {
        // Ctrl+S æˆ– Cmd+S ä¿å­˜
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            updateLastSavedTime();
            showSaveStatus('âœ“ æ‰‹åŠ¨ä¿å­˜æˆåŠŸ', 'saved');
        }
        
        // ç»Ÿè®¡å­—æ•°å˜åŒ–
        setTimeout(updateWordCount, 0);
    });
}

// åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ—¥è®°åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    initDiary();
});
        
        /* ========== éŸ³ä¹å¹³å°å¯åŠ¨å™¨åŠŸèƒ½ ========== */
        const musicMainBtn = document.getElementById('musicMainBtn');
        const musicPanel = document.getElementById('musicPanel');
        const closePanelBtn = document.getElementById('closePanelBtn');
        const customSearchInput = document.getElementById('customSearchInput');
        const customSearchBtn = document.getElementById('customSearchBtn');
        const platformSelect = document.getElementById('platformSelect');
        
        // åˆ‡æ¢é¢æ¿æ˜¾ç¤º/éšè—
        musicMainBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            musicPanel.style.display = 
                musicPanel.style.display === 'block' ? 'none' : 'block';
        });
        
        // å…³é—­é¢æ¿
        closePanelBtn.addEventListener('click', () => {
            musicPanel.style.display = 'none';
        });
        
        // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­é¢æ¿
        document.addEventListener('click', () => {
            musicPanel.style.display = 'none';
        });
        
        // é˜»æ­¢é¢æ¿å†…éƒ¨ç‚¹å‡»è§¦å‘å…³é—­
        musicPanel.addEventListener('click', (event) => {
            event.stopPropagation();
        });
        
        // å¹³å°é¡¹ç›®ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.platform-item').forEach(item => {
            item.addEventListener('click', function() {
                const url = this.getAttribute('data-url');
                const platform = this.getAttribute('data-platform');
                
                // è®°å½•ç”¨æˆ·é€‰æ‹©åå¥½
                localStorage.setItem('preferred-music-platform', platform);
                
                // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å¹³å°æœç´¢é¡µ
                window.open(url, '_blank');
                
                // å…³é—­é¢æ¿
                musicPanel.style.display = 'none';
                
                // ç»™ç”¨æˆ·åé¦ˆ
                showMessage(`æ­£åœ¨æ‰“å¼€${this.querySelector('strong').textContent}...`);
            });
        });
        
        // è‡ªå®šä¹‰æœç´¢åŠŸèƒ½
        function performCustomSearch() {
            const query = customSearchInput.value.trim();
            if (!query) {
                showMessage('è¯·è¾“å…¥æœç´¢å†…å®¹', 'warning');
                customSearchInput.focus();
                return;
            }
        
            const selectedPlatform = platformSelect.value;
            const encodedQuery = encodeURIComponent(query);
            let searchUrl = '';
        
            // æ ¹æ®ä¸åŒå¹³å°æ„å»ºæœç´¢URL
            switch(selectedPlatform) {
                case 'qqmusic':
                    searchUrl = `https://y.qq.com/portal/search.html?remoteplace=txt.yqq.top&t=song&w=${encodedQuery}`;
                    break;
                case 'ncm':
                    searchUrl = `https://music.163.com/#/search/m/?s=${encodedQuery}&type=1`;
                    break;
                default:
                    searchUrl = `https://y.qq.com/portal/search.html?w=${encodedQuery}`;
            }
        
            // æ‰“å¼€æœç´¢é¡µé¢
            window.open(searchUrl, '_blank');
            
            // æ¸…ç©ºè¾“å…¥æ¡†å¹¶å…³é—­é¢æ¿
            customSearchInput.value = '';
            musicPanel.style.display = 'none';
            
            // ä¿å­˜æœç´¢å†å²
            saveSearchHistory(query, selectedPlatform);
        }
        
        // ç»‘å®šæœç´¢äº‹ä»¶
        customSearchBtn.addEventListener('click', performCustomSearch);
        customSearchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                performCustomSearch();
            }
        });
        
        // ä¿å­˜æœç´¢å†å²ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function saveSearchHistory(query, platform) {
            const history = JSON.parse(localStorage.getItem('music-search-history') || '[]');
            history.unshift({
                query: query,
                platform: platform,
                timestamp: new Date().toISOString()
            });
            // åªä¿ç•™æœ€è¿‘10æ¡
            if (history.length > 10) history.pop();
            localStorage.setItem('music-search-history', JSON.stringify(history));
        }
        
        // æ˜¾ç¤ºä¸´æ—¶æ¶ˆæ¯
        function showMessage(text, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = text;
            messageDiv.style.cssText = `
                position: fixed;
                top: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'warning' ? 'rgba(255, 100, 100, 0.9)' : 'rgba(162, 210, 255, 0.9)'};
                color: #000;
                padding: 12px 24px;
                border-radius: 10px;
                z-index: 1000;
                font-weight: 600;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                animation: fadeOut 3s forwards;
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }
        
        // åˆå§‹åŒ–ï¼šæ¢å¤ç”¨æˆ·å¹³å°åå¥½
        const preferredPlatform = localStorage.getItem('preferred-music-platform');
        if (preferredPlatform) {
            platformSelect.value = preferredPlatform;
        }
        
        /* ========== é¡µé¢åˆå§‹åŒ– ========== */
        // é¡µé¢åŠ è½½æ—¶ç»˜åˆ¶è¯¾ç¨‹è¡¨å’Œå†å²è®°å½•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–æ•°æ®...');
            console.log('è¯¾ç¨‹æ•°æ®:', window.courses);
            console.log('å†å²è®°å½•:', window.historyRecords);
            
            drawCourses();
            drawHistory();
        });
        
        // æ·»åŠ è°ƒè¯•æŒ‰é’®ï¼ˆå¯é€‰ï¼‰
        const debugBtn = document.createElement('button');
        debugBtn.textContent = 'è°ƒè¯•';
        debugBtn.style.cssText = 'position: fixed; bottom: 150px; right: 25px; z-index: 100; padding: 10px; background: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer;';
        debugBtn.onclick = function() {
            console.log('=== è°ƒè¯•ä¿¡æ¯ ===');
            console.log('1. è¯¾ç¨‹æ•°æ®:', window.courses);
            console.log('2. localStorageè¯¾ç¨‹:', localStorage.getItem('solo-courses'));
            console.log('3. å†å²è®°å½•:', window.historyRecords);
            console.log('4. localStorageå†å²è®°å½•:', localStorage.getItem('solo-history'));
            alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°');
        };
        document.body.appendChild(debugBtn);
        
    </script>
</body>
</html>